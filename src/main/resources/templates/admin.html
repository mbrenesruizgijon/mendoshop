<!DOCTYPE html>
<html lang="es" xmlns:th="http://www.thymeleaf.org">

<head>
    <meta charset="UTF-8">
    <title>Admin Productos | MendoShop</title>
    <link rel="stylesheet" th:href="@{/style.css}">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
    <style>
        /* ===== CONTENEDOR ===== */
        .table-container {
            max-width: 1300px;
            margin: 40px auto;
            padding: 25px;
            background: #ffffff;
            border-radius: 16px;
            box-shadow: 0 8px 30px rgba(0, 0, 0, 0.12);
            overflow-x: auto;
            border: 1px solid #e8e8e8;
        }

        /* ===== TABLA ===== */
        .table-container table {
            width: 100%;
            border-collapse: separate;
            border-spacing: 0 10px;
            /* separa las filas */
            font-size: 15px;
        }

        /* ===== CABECERA ===== */
        .table-container th {
            background: #f3f3f3;
            padding: 14px;
            text-align: center;
            font-weight: 700;
            color: #444;
            border-bottom: 2px solid #ddd;
        }

        /* ===== FILAS ===== */
        .table-container tbody tr {
            background: #ffffff;
            box-shadow: 0 4px 14px rgba(0, 0, 0, 0.06);
            border-radius: 12px;
            overflow: hidden;
        }

        .table-container td {
            padding: 16px;
            text-align: center;
            vertical-align: middle;
            border-top: 1px solid #f0f0f0;
            border-bottom: 1px solid #f0f0f0;
        }

        /* redondear extremos */
        .table-container tbody tr td:first-child {
            border-radius: 12px 0 0 12px;
        }

        .table-container tbody tr td:last-child {
            border-radius: 0 12px 12px 0;
        }

        /* ===== IMÁGENES ===== */
        .table-container td img {
            width: 55px;
            height: 55px;
            object-fit: cover;
            border-radius: 8px;
        }

        /* ===== INPUTS ===== */
        .table-container input:not([type="file"]),
        .table-container select,
        .table-container textarea {
            width: 100%;
            padding: 10px 12px;
            border-radius: 8px;
            border: 1px solid #cfd1d4;
            font-size: 14px;
            background: #fafafa;
            transition: 0.2s ease;
        }

        .table-container textarea{
            height: 100px;
        }

        .table-container input[type="file"] {
            width: 100%;
        }


        /* ===== BOTONES ===== */
        .table-container button {
            padding: 8px 18px;
            border: none;
            border-radius: 8px;
            font-weight: bold;
            cursor: pointer;
            transition: 0.25s;
            font-size: 14px;
        }

        .table-container button:hover {
            transform: scale(1.05);
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.15);
        }

        /* Botón guardar */
        .table-container button.save-btn {
            background: #e41e26;
            color: white;
        }

        /* Botón eliminar */
        .table-container button.delete-btn {
            background: #d11a1a;
            color: white;
        }

        /* Botón agregar */
        .table-container button.add-btn {
            background: #2ecc71;
            color: white;
        }

        /* ===== RESPONSIVE ===== */
        @media (max-width: 768px) {

            .table-container table,
            .table-container thead,
            .table-container tbody,
            .table-container th,
            .table-container td,
            .table-container tr {
                display: block;
                width: 100%;
            }

            .table-container thead {
                display: none;
            }

            .table-container tbody tr {
                margin-bottom: 15px;
                border-radius: 12px;
                padding: 15px;
                box-shadow: 0 3px 12px rgba(0, 0, 0, 0.1);
            }

            .table-container td {
                display: flex;
                justify-content: space-between;
                padding: 8px 0;
                border: none;
            }

            .table-container td::before {
                content: attr(data-label);
                font-weight: bold;
                color: #555;
                padding-right: 10px;
            }

            .table-container td img {
                width: 70px;
                height: 70px;
            }
        }

        /* Contenedor de imagen */
        .img-cell {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 8px;
        }

        /* Fondo y estilo de la vista previa */
        .img-preview img {
            width: 60px;
            height: 60px;
            border-radius: 8px;
            object-fit: cover;
            box-shadow: 0 2px 6px rgba(0, 0, 0, 0.15);
        }

        /* Botón bonito para subir */
        .btn-file {
            background: #e41e26;
            color: white;
            padding: 6px 12px;
            border-radius: 6px;
            font-size: 13px;
            font-weight: bold;
            cursor: pointer;
            transition: 0.2s ease;
            text-align: center;
        }

        .btn-file:hover {
            background: #c2181d;
        }

        /* Ocultar input file real */
        .input-file {
            display: none;
        }
    </style>
</head>

<body>

    <header class="top-bar">
        <div class="logo-section">
            <a href="index.html"><img src="img/Logo.png" alt="MendoShop Logo" class="logo"></a>
        </div>
         <nav class="user-section">
             <p th:if="${session.usuario != null}">Bienvenido <span th:text="${session.usuario.getNombre()}"></span></p>
            <a th:if="${session.usuario != null}" href="cerrar_sesion"><i class="fas fa-user"></i> <span>Cerrar sesión</span></a>
            <a th:href="@{/adminPedidos}"><i class="fas fa-box"></i> <span>Pedidos</span></a>
            <a th:href="@{/admin}">Productos</a>
            <a th:href="@{/adminUsuarios}">Usuarios</a>
        </nav>
    </header>

    <div class="table-container">
        <table>
            <thead>
                <tr>
                    <th>ID</th>
                    <th>Nombre</th>
                    <th>Precio</th>
                    <th>Categoría</th>
                    <th>Descripción</th>
                    <th>Imagen</th>
                    <th>Stock</th>
                    <th>Peso</th>
                    <th>Descuento</th>
                    <th>Modificar</th>
                    <th>Eliminar</th>
                </tr>
            </thead>
            <tbody>
                <!-- Productos existentes -->
                <tr th:each="producto : ${productos}">
                    <form th:action="@{/editar}" method="post">
                        <td data-label="ID">
                            <p th:text="${producto.id}"></p>
                            <input type="hidden" name="id" th:value="${producto.id}">
                        </td>
                        <td data-label="Nombre"><input type="text" name="nombre" th:value="${producto.nombre}" required>
                        </td>
                        <td data-label="Precio"><input type="number" name="precio" th:value="${producto.precio}"
                                step="0.01" min="0" required></td>
                        <td data-label="Categoría">
                            <select name="categoria" required>
                                <option th:each="cat : ${categorias}" th:value="${cat}" th:text="${cat}"
                                    th:selected="${cat} == ${producto.categoria}"></option>
                            </select>
                        </td>
                        <td data-label="Descripción"><textarea name="descripcion" required
                                th:text="${producto.descripcion}"></textarea></td>
                        <td data-label="Imagen" class="img-cell">

                            <div class="img-preview">
                                <img th:src="${producto.urlImagen}" alt="">
                            </div>

                            <input type="hidden" name="urlImagen" th:value="${producto.urlImagen}">

                            <label for="imagen__${producto.id}" class="btn-file">
                                Cambiar imagen
                            </label>

                            <input type="file" id="imagen__${producto.id}" name="imagen" class="input-file">
                        </td>
                        <td data-label="Stock"><input type="number" name="stock" th:value="${producto.stock}" min="0"
                                required></td>
                        <td data-label="Peso"><input type="number" name="peso" th:value="${producto.peso}" step="0.01"
                                min="0" required></td>
                        <td data-label="Descuento"><input type="number" name="descuento"
                                th:value="${producto.descuento}" step="0.01" min="0" max="100" required></td>
                        <td>
                            <button type="submit" style="background:#e41e26; color:white;">Guardar</button>
                        </td>
                    </form>
                    <!-- ★ Nuevo TD para eliminar -->
                    <td data-label="Eliminar">
                        <form th:action="@{/delete}" method="post">
                            <input type="hidden" name="id" th:value="${producto.id}">
                            <button type="submit" style="background:red; color:white;">Eliminar</button>
                        </form>
                    </td>
                </tr>


                <!-- Nuevo producto -->
                <tr>
                    <form th:action="@{/add}" method="post" enctype="multipart/form-data"
                        onsubmit="return validarFormulario(this)">
                        <td data-label="ID">Nuevo</td>
                        <td data-label="Nombre"><input type="text" name="nombre" placeholder="Nombre" required></td>
                        <td data-label="Precio"><input type="number" step="0.01" name="precio" placeholder="0.00"
                                min="0" required></td>
                        <td data-label="Categoría">
                            <select name="categoria" required onchange="mostrarCampos(this)">
                                <option value="">--Selecciona--</option>
                                <option th:each="cat : ${categorias}" th:value="${cat}" th:text="${cat}"></option>
                            </select>
                        </td>
                        <td data-label="Descripción"><textarea name="descripcion" placeholder="Descripción"></textarea>
                        </td>
                        <td data-label="Imagen" class="img-cell">
                            <label for="imagen_nueva" class="btn-file">Subir imagen</label>
                            <input type="file" id="imagen_nueva" name="imagen" class="input-file" required>
                        </td>
                        <td data-label="Stock"><input type="number" name="stock" placeholder="0" min="0" required></td>
                        <td data-label="Peso"><input type="number" step="0.01" name="peso" placeholder="0.00" min="0"
                                required></td>
                        <td data-label="Descuento"><input type="number" step="0.01" name="descuento" placeholder="0.00"
                                min="0" max="100" required></td>
                        <td data-label="Extras">
                            <div id="verdura-fields" style="display:none;">
                                <label>Tipo de Verdura:</label>
                                <select name="tipoVerdura">
                                    <option value="">--Selecciona--</option>
                                    <option th:each="tv : ${T(mendoshop.mendoshop.TipoVerdura).values()}"
                                        th:value="${tv}" th:text="${tv}"></option>
                                </select>
                                <label>Es Temporada:</label>
                                <select name="esTemporada">
                                    <option value="true">Sí</option>
                                    <option value="false">No</option>
                                </select>
                            </div>
                            <div id="carne-fields" style="display:none;">
                                <label>Tipo de Animal:</label>
                                <select name="tipoAnimal">
                                    <option value="">--Selecciona--</option>
                                    <option th:each="ta : ${T(mendoshop.mendoshop.TipoAnimal).values()}"
                                        th:value="${ta}" th:text="${ta}"></option>
                                </select>
                                <label>Origen:</label>
                                <input type="text" name="origen">
                            </div>
                        </td>
                        <td><button type="submit" style="background:green; color:white;">Agregar</button></td>
                    </form>
                </tr>
            </tbody>
        </table>
    </div>

    <footer>
        <div class="footer-container">
            <div class="footer-logo">MENDOSHOP</div>
            <div class="footer-copy">© 2025 Mendashop. Todos los derechos reservados.</div>
        </div>
    </footer>

    <script>
        function mostrarCampos(tipoSelect) {
            const verduraFields = document.getElementById('verdura-fields');
            const carneFields = document.getElementById('carne-fields');
            verduraFields.style.display = 'none';
            carneFields.style.display = 'none';
            const valor = tipoSelect.value.toLowerCase();
            if (valor === 'verdura') verduraFields.style.display = 'block';
            else if (valor === 'carne') carneFields.style.display = 'block';
        }

        function validarFormulario(form) {
            const precio = parseFloat(form.precio.value);
            const stock = parseInt(form.stock.value);
            const peso = parseFloat(form.peso.value);
            const descuento = parseFloat(form.descuento.value);

            if (precio < 0 || stock < 0 || peso < 0) {
                alert("Precio, stock y peso no pueden ser negativos.");
                return false;
            }
            if (descuento < 0 || descuento > 100) {
                alert("El descuento debe estar entre 0 y 100.");
                return false;
            }
            if (!form.categoria.value) {
                alert("Debes seleccionar la categoría del producto.");
                return false;
            }
            return true;
        }
    </script>

</body>

</html>